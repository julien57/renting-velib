!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const o=["img/slide1.jpg","img/slide2.jpg","img/slide3.jpg"],i=["Vous pouvez réserver votre vélib directement sur le site","Sur la carte, cliquez sur le marqueur de votre choix","Signez ensuite pour confirmer la réservation"];class s{constructor(){this.image=o,this.description=i,this.position=0}decrire(){$("#slide1 img").attr("src",this.image[this.position]),$("#description_slide").text(this.description[this.position])}avancer(){this.position<this.image.length-1?this.position++:this.position=0,s.decrire()}reculer(){this.position>0?this.position--:this.position=this.image.length-1,this.decrire()}}$("#suiv").click(function(){s.avancer()}),$("#prec").click(function(){s.reculer()}),$("body").keydown(function(e){switch(e.which){case 39:s.avancer();break;case 37:s.reculer();break;default:console.log("Utiliser les flèches du clavier pour utiliser le diaporama.")}});class r{constructor(e,t){this.station=e,this.time=t}reservationConfirme(){clearInterval(a),sessionStorage.setItem("station",this.station),this.station=sessionStorage.getItem("station"),sessionStorage.setItem("time",this.time),this.time=sessionStorage.getItem("time"),a=setInterval(r.gestionTemps,1e3)}static gestionTemps(){let e=Number(sessionStorage.getItem("time"));const t=document.getElementById("reservation_ok");null===sessionStorage.getItem("time")?(t.textContent="Aucune réservation",sessionStorage.clear(),clearInterval(a)):sessionStorage.getItem("time")>0?(e--,sessionStorage.setItem("time",e),t.textContent=`Une réservation à la station ${sessionStorage.getItem("station").toLowerCase()}, temps restant : ${Math.floor(e/60)}m ${e%60}s.`):(t.textContent="Aucune réservation",sessionStorage.clear(),clearInterval(this.intervalId))}}let a;function l(e){document.querySelector("fieldset").style.display="none",document.getElementById("signature").style.display="block";const t=document.getElementById("confirmeStation");t.innerHTML="";const n=e;t.appendChild(document.createTextNode(`Confirmation pour la station ${n}`));const o=document.getElementById("signature_message");o.textContent="";const i=document.getElementById("canvas");i.width=i.width;const s=i.getContext("2d");s.strokeStyle="#222222",s.lineWith=3;let a=!1,l=!1,c={x:0,y:0},d=c;function u(e,t){const n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}i.addEventListener("mousedown",e=>{a=!0,l=!0,d=u(i,e)},!1),i.addEventListener("mouseup",()=>{l=!1},!1),i.addEventListener("mousemove",e=>{c=u(i,e)},!1),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimaitonFrame||function(e){window.setTimeout(e,1e3/60)},function e(){requestAnimFrame(e),l&&(s.moveTo(d.x,d.y),s.lineTo(c.x,c.y),s.stroke(),d=c)}(),i.addEventListener("touchstart",e=>{c=function(e,t){const n=e.getBoundingClientRect();return{x:t.touches[0].clientX-n.left,y:t.touches[0].clientY-n.top}}(i,e);const t=e.touches[0],n=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});i.dispatchEvent(n)},!1),i.addEventListener("touchend",()=>{const e=new MouseEvent("mouseup",{});i.dispatchEvent(e)},!1),i.addEventListener("touchmove",e=>{const t=e.touches[0],n=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});i.dispatchEvent(n)},!1),document.body.addEventListener("touchstart",e=>{e.target==i&&e.preventDefault()},!1),document.body.addEventListener("touchend",e=>{e.target==i&&e.preventDefault()},!1),document.body.addEventListener("touchmove",e=>{e.target==i&&e.preventDefault()},!1),document.getElementById("reinitialisation").addEventListener("click",()=>{i.width=i.width,a=!1}),document.getElementById("validation").addEventListener("click",()=>{if(!1===a)o.textContent="Merci de confirmer par signature.";else{a=!1,document.getElementById("signature").style.display="none",new r(n,1200).reservationConfirme()}})}class c{constructor(e,t,n,o,i,s){this.location=e,this.name=t,this.address=n,this.status=o,this.nbBike=i,this.availableBikes=s}detailStation(){document.getElementById("signature").style.display="none",document.querySelector("fieldset").style.display="block";const e=document.getElementById("nom_station");e.textContent=this.name,document.getElementById("adresse").textContent=this.address,document.getElementById("etat").textContent=c.statusTranslation(this.status),document.getElementById("nb_velos").textContent=this.nbBike,document.getElementById("velos_disponibles").textContent=this.availableBikes,c.disponibiliteVelos(this.availableBikes),document.getElementById("reservationVelo")&&document.getElementById("reservationVelo").addEventListener("click",()=>{l(e.textContent)})}static disponibiliteVelos(e){const t=document.getElementById("bouton_reservation");if(e>0){const e=document.createElement("button");e.setAttribute("id","reservationVelo"),e.textContent="Réservez un vélo",t.innerHTML="",t.appendChild(e)}else t.textContent="Aucun vélo de disponible..."}static statusTranslation(e){return e="OPEN"===e?"Ouverte":"Fermée"}}class d{initMap(){return{center:new google.maps.LatLng(45.762,4.845),zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP}}initMarkers(e,t){const n=new google.maps.Map(document.getElementById("map"),t);d.ajaxGet(e,function(e){const t=JSON.parse(e);for(let e of t){new google.maps.Marker({position:e.position,title:e.name,map:n,draggable:!0,animation:google.maps.Animation.DROP}).addListener("click",()=>{console.log(e.address),new c(e.position,e.name,e.address,e.status,e.bike_stands,e.available_bikes).detailStation()})}})}static ajaxGet(e,t){const n=new XMLHttpRequest;n.open("GET",e),n.addEventListener("load",function(){n.status>=200&&n.status<400?t(n.responseText):console.error(n.status+" "+n.statusText+" "+e)}),n.addEventListener("error",function(){console.error("Erreur réseau avec l'URL "+e)}),n.send(null)}}window.onload=(()=>{document.querySelector("fieldset").style.display="none",document.getElementById("signature").style.display="none",(new s).decrire();const e=new d,t=e.initMap();if(e.initMarkers("https://api.jcdecaux.com/vls/v1/stations?contract=Lyon&apiKey=e5108e6a624c0893e1e3155785f8116190947008",t),null!==sessionStorage.getItem("time")){new r(sessionStorage.getItem("station"),sessionStorage.getItem("time")).reservationConfirme()}else document.getElementById("reservation_ok").textContent="Aucune réservation en cours"})}]);